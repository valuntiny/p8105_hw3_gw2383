---
title: "p8105_hw3_gw2383"
author: "Guojing Wu"
date: "2018/10/7"
output: html_document
# output:
#   github_document:
#     toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(p8105.datasets)
```

## Problem 1

### data cleaning

```{r}
brfss_df =
  p8105.datasets::brfss_smart2010 %>%
  janitor::clean_names() %>% # cleaning
  rename(location_abbr = locationabbr, location_desc = locationdesc) %>% # format the variable name
  filter(topic == "Overall Health") %>% # focus on the “Overall Health” topic
  filter(response %in% c("Poor", "Fair", "Good", "Very good", "Excellent")) %>% # choose response
  arrange(response) # organize responses
```

### some questions

* In 2002, `r names(which(brfss_df %>% filter(year == 2002) %>% distinct(location_abbr, location_desc) %>% select(location_abbr) %>% table() == 7))` states were observed at 7 locations

* spaghetti plot

```{r}
brfss_df %>%
  distinct(year, location_abbr, location_desc) %>%
  group_by(year, location_abbr) %>%
  summarise(n = n()) %>%
  ggplot(aes(x = year, y = n, group = location_abbr, color = location_abbr)) +
  geom_line() +
  labs(
    y = "number of observatons",
    title = " number of observations in each state from 2002 to 2010"
  ) +
  theme_bw()
```

* a table of mean and standard deviation

```{r}
table_exc = brfss_df %>%
  filter(year %in% c(2002, 2006, 2010) & location_abbr == "NY" & response == "Excellent") %>%
  group_by(year) %>%
  summarise(mean_exc = mean(data_value),
            sd_exc = sd(data_value))
```

: Table. Mean and standard deviation of the proportion of “Excellent” responses across locations in NY State

|year  |mean of “Excellent” responses|standard deviation of “Excellent” responses|
|:----:|:---------------------------:|:-----------------------------------------:|
|`r table_exc[1,1]`|`r table_exc[1,2]`|`r table_exc[1,3]`|
|`r table_exc[2,1]`|`r table_exc[2,2]`|`r table_exc[2,3]`|
|`r table_exc[3,1]`|`r table_exc[3,2]`|`r table_exc[3,3]`|

* a five-panel plot

```{r}
brfss_df %>%
  group_by(year, location_abbr, response) %>%
  summarise(mean_prop = mean(data_value)) %>%
  ggplot(aes(x = year, y = mean_prop, group = location_abbr, color = location_abbr)) +
  geom_line() +
  labs(y = "average proportion") +
  facet_grid(response ~ ., scales = "free") +
  theme_bw()
```

## Problem 2

### short description

```{r}
insta_df = p8105.datasets::instacart %>% 
  janitor::clean_names()
```

There are `r dim(insta_df)[2]` variables and `r dim(insta_df)[1]` observations in this dataset. It contains details of every order: like user id, order id, product id, product name, whether it's reordered or not, ...
```{r} 
insta_df %>% select(user_id, order_id, product_id, product_name, reordered) %>% head(10)
```

Also, in the local store, there are `r dim(distinct(insta_df, department))[1]` departments.

### some questions

* There are `r dim(distinct(insta_df, aisle))[1]` aisles in the store. `r (insta_df %>% group_by(aisle) %>% summarise(item_sum = n()) %>% arrange(desc(item_sum)))[1,1]` aisle is the most items ordered from.

* 